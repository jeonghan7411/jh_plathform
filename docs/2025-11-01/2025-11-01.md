# ì‘ì—… ë¡œê·¸ - 2025ë…„ 11ì›” 1ì¼

## ğŸ“‹ ì‘ì—… ê°œìš”
ì˜¤ëŠ˜ì€ JWT í•„í„° ê¸°ë°˜ ìë™ ì¸ì¦ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ê³ , í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¥¸ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ”§ ì£¼ìš” ì‘ì—… ë‚´ìš©

### 1. JWT í•„í„° ê¸°ë°˜ ìë™ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬ì¶• (ë°±ì—”ë“œ)

#### 1.1 JwtAuthenticationFilter ìƒì„±
**íŒŒì¼**: `auth/auth/src/main/java/jh_platform/auth/config/JwtAuthenticationFilter.java`

- **ëª©ì **: ëª¨ë“  ìš”ì²­ì—ì„œ ì¿ í‚¤ì˜ JWT í† í°ì„ ìë™ìœ¼ë¡œ ê²€ì¦í•˜ê³  ì¸ì¦ ì •ë³´ ì„¤ì •
- **ê¸°ëŠ¥**:
  - HttpOnly Cookieì—ì„œ `accessToken` ì¶”ì¶œ
  - í† í° ìœ íš¨ì„± ê²€ì¦ (`JwtTokenProvider.validateToken()`)
  - ìœ íš¨í•œ í† í°ì´ë©´ `SecurityContext`ì— ì¸ì¦ ì •ë³´ ì„¤ì •
  - `UsernamePasswordAuthenticationToken` ìƒì„± ë° ê¶Œí•œ ë¶€ì—¬ (`ROLE_USER`)

```java
@Override
protected void doFilterInternal(
        HttpServletRequest request,
        HttpServletResponse response,
        FilterChain filterChain
) throws ServletException, IOException {
    String token = extractTokenFromCookie(request);
    
    if (token != null && jwtTokenProvider.validateToken(token)) {
        String username = jwtTokenProvider.getUsername(token);
        
        UsernamePasswordAuthenticationToken authentication =
                new UsernamePasswordAuthenticationToken(
                        username,
                        null,
                        Collections.singletonList(new SimpleGrantedAuthority("ROLE_USER"))
                );
        
        SecurityContextHolder.getContext().setAuthentication(authentication);
    }
    
    filterChain.doFilter(request, response);
}
```

#### 1.2 SecurityConfig ìˆ˜ì •
**íŒŒì¼**: `auth/auth/src/main/java/jh_platform/auth/config/SecurityConfig.java`

- **ë³€ê²½ ì‚¬í•­**:
  - JWT í•„í„°ë¥¼ í•„í„° ì²´ì¸ì— ì¶”ê°€ (`addFilterBefore()`)
  - `/api/auth/signup`, `/api/auth/login`ë§Œ `permitAll()` ì„¤ì •
  - ë‚˜ë¨¸ì§€ ëª¨ë“  ê²½ë¡œëŠ” `authenticated()`ë¡œ ì„¤ì • (JWT í•„í„°ì—ì„œ ìë™ ê²€ì¦)

```java
.addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class)
.authorizeHttpRequests(authz -> authz
    .requestMatchers("/api/auth/signup", "/api/auth/login").permitAll()
    .anyRequest().authenticated()
)
```

#### 1.3 AuthController ìˆ˜ì •
**íŒŒì¼**: `auth/auth/src/main/java/jh_platform/auth/controller/AuthController.java`

- **ë³€ê²½ ì‚¬í•­**:
  - `getUserInfo()` ë©”ì„œë“œì—ì„œ ì¿ í‚¤ì—ì„œ ì§ì ‘ í† í° ì¶”ì¶œ ë¡œì§ ì œê±°
  - `SecurityContext`ì—ì„œ ì¸ì¦ ì •ë³´ ê°€ì ¸ì˜¤ê¸°ë¡œ ë³€ê²½
  - JWT í•„í„°ì—ì„œ ì´ë¯¸ ì¸ì¦ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ ê°„ì†Œí™”

```java
@GetMapping("/user")
public ApiResponse<User> getUserInfo() {
    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
    
    if (authentication == null || !authentication.isAuthenticated()) {
        return ApiResponse.error(401, "ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤.");
    }
    
    String username = authentication.getName();
    User user = authService.getUserInfo(username);
    
    return ApiResponse.success(user);
}
```

#### 1.4 í•„í„° ì²´ì¸ ì‹¤í–‰ ìˆœì„œ
```
ìš”ì²­ â†’ JWT í•„í„° (í† í° ê²€ì¦ ë° SecurityContext ì„¤ì •) 
    â†’ FilterSecurityInterceptor (ê¶Œí•œ ì²´í¬) 
    â†’ ì»¨íŠ¸ë¡¤ëŸ¬
```

---

### 2. ReturnPage ì»´í¬ë„ŒíŠ¸ ìƒì„± (í”„ë¡ íŠ¸ì—”ë“œ)

#### 2.1 ReturnPage.js ìƒì„±
**íŒŒì¼**: `portal/portal_fronted/src/pages/main/ReturnPage.js`

- **ëª©ì **: ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì— í‘œì‹œí•  ì»´í¬ë„ŒíŠ¸
- **ê¸°ëŠ¥**:
  - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ ë²„íŠ¼
  - íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™ ë²„íŠ¼
  - ëª¨ë˜í•œ UI ë””ìì¸ (ê·¸ë¼ë°ì´ì…˜ ë°°ê²½, ì• ë‹ˆë©”ì´ì…˜)

#### 2.2 ReturnPage.css ìƒì„±
**íŒŒì¼**: `portal/portal_fronted/src/pages/main/ReturnPage.css`

- ë°˜ì‘í˜• ë””ìì¸ (ëª¨ë°”ì¼ ëŒ€ì‘)
- ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
- ì¼ê´€ëœ ìƒ‰ìƒ ì²´ê³„ (íŒŒë€ìƒ‰ ê³„ì—´)

---

### 3. ì¸ì¦ ìƒíƒœ ê¸°ë°˜ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ êµ¬í˜„ (í”„ë¡ íŠ¸ì—”ë“œ)

#### 3.1 LoginPage ìˆ˜ì •
**íŒŒì¼**: `portal/portal_fronted/src/pages/login/LoginPage.js`

- **ë³€ê²½ ì‚¬í•­**:
  - Zustandì—ì„œ `user` ìƒíƒœ í™•ì¸
  - ì‚¬ìš©ì ì •ë³´ê°€ ìˆìœ¼ë©´ `/main`ìœ¼ë¡œ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸
  - ì„œë²„ í˜¸ì¶œ ì—†ì´ ë¡œì»¬ ìƒíƒœë§Œ í™•ì¸ (ì„±ëŠ¥ ìµœì í™”)

```javascript
useEffect(() => {
    if (user) {
        navigate('/main', { replace: true });
    }
}, [user, navigate]);
```

#### 3.2 SignupPage ìˆ˜ì •
**íŒŒì¼**: `portal/portal_fronted/src/pages/Signup/SignupPage.js`

- LoginPageì™€ ë™ì¼í•œ ë¡œì§ ì ìš©
- ì´ë¯¸ ë¡œê·¸ì¸ë˜ì–´ ìˆìœ¼ë©´ íšŒì›ê°€ì… í˜ì´ì§€ ì ‘ê·¼ ì‹œ `/main`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

---

## ğŸ’¡ í•µì‹¬ ê°œì„  ì‚¬í•­

### 1. ìë™ ì¸ì¦ ì‹œìŠ¤í…œ
- **ì´ì „**: ê° APIì—ì„œ ê°œë³„ì ìœ¼ë¡œ í† í° ê²€ì¦ (`permitAll()`ì— ê²½ë¡œ ì¶”ê°€ í•„ìš”)
- **ê°œì„ **: JWT í•„í„°ì—ì„œ ëª¨ë“  ìš”ì²­ ìë™ ê²€ì¦ (ìƒˆ API ì¶”ê°€ ì‹œ ë³„ë„ ì„¤ì • ë¶ˆí•„ìš”)

### 2. í™•ì¥ì„± í–¥ìƒ
- APIê°€ ëŠ˜ì–´ë‚˜ë„ `SecurityConfig`ì— ê²½ë¡œ ì¶”ê°€ ë¶ˆí•„ìš”
- JWT í•„í„°ì—ì„œ ìë™ìœ¼ë¡œ ëª¨ë“  ìš”ì²­ ê²€ì¦
- ì»¨íŠ¸ë¡¤ëŸ¬ ì½”ë“œ ê°„ì†Œí™” (í† í° ê²€ì¦ ë¡œì§ ì œê±°)

### 3. ì„±ëŠ¥ ìµœì í™”
- LoginPage/SignupPageì—ì„œ ë¶ˆí•„ìš”í•œ ì„œë²„ í˜¸ì¶œ ì œê±°
- Zustand ë¡œì»¬ ìƒíƒœë§Œ í™•ì¸í•˜ì—¬ ì¦‰ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- ì‚¬ìš©ì ì •ë³´ëŠ” í•„ìš”í•  ë•Œë§Œ HomePageì—ì„œ ì¡°íšŒ

### 4. ë³´ì•ˆ ê°•í™”
- ëª¨ë“  ìš”ì²­ì´ JWT í•„í„°ë¥¼ í†µê³¼í•˜ì—¬ ì¼ê´€ëœ ì¸ì¦ ì²˜ë¦¬
- SecurityContextë¥¼ í†µí•œ ì¤‘ì•™í™”ëœ ì¸ì¦ ê´€ë¦¬

---

## ğŸ”„ ë™ì‘ íë¦„

### ë¡œê·¸ì¸ íë¦„
```
1. ì‚¬ìš©ì ë¡œê·¸ì¸ ìš”ì²­
2. AuthController.login() â†’ í† í° ìƒì„± + HttpOnly Cookie ì„¤ì •
3. LoginFormì—ì„œ onLoginSuccess() í˜¸ì¶œ
4. /mainìœ¼ë¡œ ì´ë™
5. HomePageì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (refetchUser)
6. Zustandì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
```

### ì¸ì¦ì´ í•„ìš”í•œ API í˜¸ì¶œ
```
1. í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ (ì¿ í‚¤ ìë™ í¬í•¨)
2. JWT í•„í„°: ì¿ í‚¤ì—ì„œ í† í° ì¶”ì¶œ ë° ê²€ì¦
3. ìœ íš¨í•˜ë©´ SecurityContextì— ì¸ì¦ ì •ë³´ ì„¤ì •
4. FilterSecurityInterceptor: authenticated() ì²´í¬
5. í†µê³¼ â†’ ì»¨íŠ¸ë¡¤ëŸ¬ ì‹¤í–‰
```

### ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ (LoginPage/SignupPage)
```
1. í˜ì´ì§€ ë§ˆìš´íŠ¸
2. Zustandì—ì„œ user í™•ì¸
3. ìˆìœ¼ë©´ â†’ /mainìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì„œë²„ í˜¸ì¶œ ì—†ìŒ)
4. ì—†ìœ¼ë©´ â†’ ë¡œê·¸ì¸/íšŒì›ê°€ì… í¼ í‘œì‹œ
```

---

## ğŸ“ ë³€ê²½ëœ íŒŒì¼ ëª©ë¡

### ë°±ì—”ë“œ
- âœ… `auth/auth/src/main/java/jh_platform/auth/config/JwtAuthenticationFilter.java` (ì‹ ê·œ)
- âœ… `auth/auth/src/main/java/jh_platform/auth/config/SecurityConfig.java` (ìˆ˜ì •)
- âœ… `auth/auth/src/main/java/jh_platform/auth/controller/AuthController.java` (ìˆ˜ì •)

### í”„ë¡ íŠ¸ì—”ë“œ
- âœ… `portal/portal_fronted/src/pages/main/ReturnPage.js` (ì‹ ê·œ)
- âœ… `portal/portal_fronted/src/pages/main/ReturnPage.css` (ì‹ ê·œ)
- âœ… `portal/portal_fronted/src/pages/login/LoginPage.js` (ìˆ˜ì •)
- âœ… `portal/portal_fronted/src/pages/Signup/SignupPage.js` (ìˆ˜ì •)

---

## ğŸ¯ ë‹¤ìŒ ì‘ì—… ì˜ˆì • ì‚¬í•­

1. í† í° ê°±ì‹  (Refresh Token) ê¸°ëŠ¥ êµ¬í˜„
2. ê¶Œí•œë³„ ì ‘ê·¼ ì œì–´ (ROLE ê¸°ë°˜)
3. ë¡œë”© ìƒíƒœ ê°œì„  (ìŠ¤í”¼ë„ˆ ë˜ëŠ” ìŠ¤ì¼ˆë ˆí†¤ UI)
4. ì—ëŸ¬ ì²˜ë¦¬ ê°œì„  (í† í° ë§Œë£Œ ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ)

---

## ğŸ“ ì°¸ê³  ì‚¬í•­

- JWT í•„í„°ëŠ” `UsernamePasswordAuthenticationFilter` ì´ì „ì— ì‹¤í–‰ë¨
- HttpOnly Cookie ì‚¬ìš©ìœ¼ë¡œ XSS ê³µê²© ë°©ì§€
- `replace: true` ì˜µì…˜ìœ¼ë¡œ ë¸Œë¼ìš°ì € íˆìŠ¤í† ë¦¬ ê´€ë¦¬
- Zustand persist ë¯¸ë“¤ì›¨ì–´ë¡œ ì‚¬ìš©ì ì •ë³´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥

